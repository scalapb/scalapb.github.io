<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="ScalaPB Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="ScalaPB Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-346180-20","auto"),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script><title data-react-helmet="true">Writing generic code | ScalaPB</title><meta data-react-helmet="true" property="og:image" content="https://scalapb.github.io/img/scalapb-social-light.png"><meta data-react-helmet="true" name="twitter:image" content="https://scalapb.github.io/img/scalapb-social-light.png"><meta data-react-helmet="true" name="twitter:image:alt" content="Image for ScalaPB"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Writing generic code | ScalaPB"><meta data-react-helmet="true" name="description" content="In some cases you will want to write generic code that can handle arbitrary"><meta data-react-helmet="true" property="og:description" content="In some cases you will want to write generic code that can handle arbitrary"><meta data-react-helmet="true" property="og:url" content="https://scalapb.github.io//docs/generic"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://scalapb.github.io//docs/generic"><link rel="stylesheet" href="/styles.189e0da9.css">
<link rel="preload" href="/styles.e145afce.js" as="script">
<link rel="preload" href="/runtime~main.a20cdc95.js" as="script">
<link rel="preload" href="/main.0fd1eac8.js" as="script">
<link rel="preload" href="/1.d720bdf5.js" as="script">
<link rel="preload" href="/2.5b37da85.js" as="script">
<link rel="preload" href="/49.555e99e2.js" as="script">
<link rel="preload" href="/50.7731d502.js" as="script">
<link rel="preload" href="/935f2afb.5e094e5e.js" as="script">
<link rel="preload" href="/17896441.4206d928.js" as="script">
<link rel="preload" href="/c101867e.9ded73fc.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img src="/img/ScalaPB.png" alt="ScalaPB" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/ScalaPB.png" alt="ScalaPB" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Docs</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/scalapb/ScalaPB" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/ScalaPB.png" alt="ScalaPB" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/ScalaPB.png" alt="ScalaPB" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/docs/">Docs</a></li><li class="menu__list-item"><a href="https://github.com/scalapb/ScalaPB" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_vMrn"><div class="docSidebarContainer_3Ak5" role="complementary"><div class="sidebar_3gvy"><div class="menu menu--responsive thin-scrollbar menu_1yIk"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_1CUI" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menuLinkText_yu3-">Getting Started</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/installation">Installation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/getting-started">Tutorial</a></li></ul></li><li class="menu__list-item"><a class="menu__link menuLinkText_yu3-">Customizing</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/customizations">Customizations</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sbt-settings">SBT Settings</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/transformations">Transformations</a></li></ul></li><li class="menu__list-item"><a class="menu__link menuLinkText_yu3-">Guides</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/generated-code">Generated Code</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sealed-oneofs">Sealed oneofs</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/user_defined_options">User-defined options</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/grpc">gRPC</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/scala.js">Scala.js</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sparksql">SparkSQL</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/json">JSON</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/scalapbc">ScalaPBC</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/dotty">Dotty</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/third-party-protos">Using third-party protos</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/common-protos">Common protos</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/validation">Validation</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/generic">Generic programming</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/writing-plugins">Writing protoc plugins</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/upgrading">Upgrading</a></li></ul></li><li class="menu__list-item"><a class="menu__link menuLinkText_yu3-">Getting Help</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/faq">FAQ</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/contact">Contacting us</a></li></ul></li></ul></div></div></div><main class="docMainContainer_2iGs"><div class="container padding-vert--lg docItemWrapper_1bxp"><div class="row"><div class="col docItemCol_U38p"><div class="docItemContainer_a7m4"><article><header><h1 class="docTitle_Oumm">Writing generic code</h1></header><div class="markdown"><p>In some cases you will want to write generic code that can handle arbitrary
message types. This guide will show you various techniques that you can use
to accomplish that.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="generated-types"></a>Generated types<a class="hash-link" href="#generated-types" title="Direct link to heading">#</a></h2><p>For each message in your proto files, ScalaPB will generate a case class which
extends the <code>GeneratedMessage[MessageType]</code> and a companion object:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-scala codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#403f53;background-color:#FBFBFB"><div class="token-line" style="color:#403f53"><span class="token plain">case class MyMessage(...) extends scalapb.GeneratedMessage</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">object MyMessage extends scalapb.generatedMessageCompanion[MyMessage]</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Generally speaking, the case class would have methods that act on a given
instance. Here are the important ones:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-scala codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#403f53;background-color:#FBFBFB"><div class="token-line" style="color:#403f53"><span class="token plain">trait GeneratedMessage {</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  // Serializes this message to the given output stream.</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  def writeTo(output: OutputStream): Unit</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  </span></div><div class="token-line" style="color:#403f53"><span class="token plain">  // Serializes this message into an array of bytes</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  def toByteArray: Array[Byte] = {</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  // Returns the companion object of this message.</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  def companion: GeneratedMessageCompanion[_]</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  // Returns a proto string representation of this message.</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  def toProtoString: String</span></div><div class="token-line" style="color:#403f53"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>The companion, in turn, provides methods to create new instances of the type,
as well as retrieving the descriptors of the messages. The descriptors can be
used to query structural information about the proto files at runtime. Note
that the <code>GeneratedMessageCompanion</code> takes a type parameter <code>A</code> which
represents the message case class (must be a subtype of <code>GeneratedMessage</code>):</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-scala codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#403f53;background-color:#FBFBFB"><div class="token-line" style="color:#403f53"><span class="token plain">trait GeneratedMessageCompanion[A &lt;: GeneratedMessage] {</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  // Parses a message of type A from a byte array.</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  def parseFrom(s: Array[Byte]): A</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  // Returns the Java descriptors</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  def javaDescriptor: com.google.protobuf.Descriptors.Descriptor</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  // Returns the Scala descriptors</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  def scalaDescriptor: scalapb.descriptors.Descriptor</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  // Returns the companion for a field. The field must be a message field.</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  def messageCompanionForFieldNumber(field: Int): GeneratedMessageCompanion[_]</span></div><div class="token-line" style="color:#403f53"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="writing-a-function-that-accepts-any-message-type"></a>Writing a function that accepts any message type<a class="hash-link" href="#writing-a-function-that-accepts-any-message-type" title="Direct link to heading">#</a></h2><p>The following is an example of a function that takes an instance of a message
and writes it to a file.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-scala codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#403f53;background-color:#FBFBFB"><div class="token-line" style="color:#403f53"><span class="token plain">import java.nio.file.{Files, Paths}</span></div><div class="token-line" style="color:#403f53"><span class="token plain">import scalapb.GeneratedMessage</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">def writeToFile[A &lt;: GeneratedMessage](msg: A, fileName: String): Unit = {</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  Files.write(Paths.get(fileName), msg.toByteArray)</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  ()</span></div><div class="token-line" style="color:#403f53"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="summoning-the-companion"></a>Summoning the companion<a class="hash-link" href="#summoning-the-companion" title="Direct link to heading">#</a></h2><p>In our next example, we will write a function that reads a file and parse it
into a message of type <code>A</code>. To build a new instance of a message, we need to
call <code>parseFrom</code> on the companion. Using Scala&#x27;s implicit search, it is easy
to obtain the companion of any message type:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-scala codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#403f53;background-color:#FBFBFB"><div class="token-line" style="color:#403f53"><span class="token plain">import java.nio.file.{Files, Paths}</span></div><div class="token-line" style="color:#403f53"><span class="token plain">import scalapb.{GeneratedMessage, GeneratedMessageCompanion}</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">def readFromFile[A &lt;: GeneratedMessage](fileName: String)(</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  implicit cmp: GeneratedMessageCompanion[A]): A = {</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    val byteArray = Files.readAllBytes(Paths.get(fileName))</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    cmp.parseFrom(byteArray)</span></div><div class="token-line" style="color:#403f53"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>When calling this function, you need to provide the specific type you want it
to return, and the filename. The Scala compiler will automatically find the
appropriate message companion to pass as <code>cmp</code> via implicit search:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-scala codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#403f53;background-color:#FBFBFB"><div class="token-line" style="color:#403f53"><span class="token plain">readFromFile[Person](&quot;/tmp/person.pb&quot;)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div></div></article><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/validation"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Validating Protobufs</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/writing-plugins"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Writing protoc plugins in Scala Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#generated-types" class="table-of-contents__link">Generated types</a></li><li><a href="#writing-a-function-that-accepts-any-message-type" class="table-of-contents__link">Writing a function that accepts any message type</a></li><li><a href="#summoning-the-companion" class="table-of-contents__link">Summoning the companion</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/">Introduction</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/installation">Installation</a></li><li class="footer__item"><a href="https://scalapb.github.io/api/scalapb" target="_blank" rel="noopener noreferrer" class="footer__link-item">ScalaDoc</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/scalapb" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow</a></li><li class="footer__item"><a href="https://gitter.im/ScalaPB/community" target="_blank" rel="noopener noreferrer" class="footer__link-item">Gitter</a></li><li class="footer__item"><a href="https://groups.google.com/g/scalapb" target="_blank" rel="noopener noreferrer" class="footer__link-item">Google Groups</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/scalapb/ScalaPB" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2014-2021, <a href="https://www.linkedin.com/in/nadav-samet/">Nadav Samet</a></div></div></div></footer></div>
<script src="/styles.e145afce.js"></script>
<script src="/runtime~main.a20cdc95.js"></script>
<script src="/main.0fd1eac8.js"></script>
<script src="/1.d720bdf5.js"></script>
<script src="/2.5b37da85.js"></script>
<script src="/49.555e99e2.js"></script>
<script src="/50.7731d502.js"></script>
<script src="/935f2afb.5e094e5e.js"></script>
<script src="/17896441.4206d928.js"></script>
<script src="/c101867e.9ded73fc.js"></script>
</body>
</html>