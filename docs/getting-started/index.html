<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="ScalaPB Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="ScalaPB Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-346180-20","auto"),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script><title data-react-helmet="true">Protocol Buffer Tutorial: Scala | ScalaPB</title><meta data-react-helmet="true" property="og:image" content="https://scalapb.github.io/img/scalapb-social-light.png"><meta data-react-helmet="true" name="twitter:image" content="https://scalapb.github.io/img/scalapb-social-light.png"><meta data-react-helmet="true" name="twitter:image:alt" content="Image for ScalaPB"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Protocol Buffer Tutorial: Scala | ScalaPB"><meta data-react-helmet="true" name="description" content="This tutorial provides a basic Scala programmer&#x27;s introduction to working with protocol buffers. By walking through creating a simple example application, it shows you how to"><meta data-react-helmet="true" property="og:description" content="This tutorial provides a basic Scala programmer&#x27;s introduction to working with protocol buffers. By walking through creating a simple example application, it shows you how to"><meta data-react-helmet="true" property="og:url" content="https://scalapb.github.io//docs/getting-started"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://scalapb.github.io//docs/getting-started"><link rel="stylesheet" href="/styles.189e0da9.css">
<link rel="preload" href="/styles.e145afce.js" as="script">
<link rel="preload" href="/runtime~main.4f711bfc.js" as="script">
<link rel="preload" href="/main.0fd1eac8.js" as="script">
<link rel="preload" href="/1.d720bdf5.js" as="script">
<link rel="preload" href="/2.5b37da85.js" as="script">
<link rel="preload" href="/49.555e99e2.js" as="script">
<link rel="preload" href="/50.7731d502.js" as="script">
<link rel="preload" href="/935f2afb.5e094e5e.js" as="script">
<link rel="preload" href="/17896441.4206d928.js" as="script">
<link rel="preload" href="/63f1a026.202b3e00.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img src="/img/ScalaPB.png" alt="ScalaPB" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/ScalaPB.png" alt="ScalaPB" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Docs</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/scalapb/ScalaPB" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/ScalaPB.png" alt="ScalaPB" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/ScalaPB.png" alt="ScalaPB" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/docs/">Docs</a></li><li class="menu__list-item"><a href="https://github.com/scalapb/ScalaPB" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_vMrn"><div class="docSidebarContainer_3Ak5" role="complementary"><div class="sidebar_3gvy"><div class="menu menu--responsive thin-scrollbar menu_1yIk"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_1CUI" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menuLinkText_yu3-">Getting Started</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/installation">Installation</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/getting-started">Tutorial</a></li></ul></li><li class="menu__list-item"><a class="menu__link menuLinkText_yu3-">Customizing</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/customizations">Customizations</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sbt-settings">SBT Settings</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/transformations">Transformations</a></li></ul></li><li class="menu__list-item"><a class="menu__link menuLinkText_yu3-">Guides</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/generated-code">Generated Code</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sealed-oneofs">Sealed oneofs</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/user_defined_options">User-defined options</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/grpc">gRPC</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/scala.js">Scala.js</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sparksql">SparkSQL</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/json">JSON</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/scalapbc">ScalaPBC</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/dotty">Dotty</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/third-party-protos">Using third-party protos</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/common-protos">Common protos</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/validation">Validation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/generic">Generic programming</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/writing-plugins">Writing protoc plugins</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/upgrading">Upgrading</a></li></ul></li><li class="menu__list-item"><a class="menu__link menuLinkText_yu3-">Getting Help</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/faq">FAQ</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/contact">Contacting us</a></li></ul></li></ul></div></div></div><main class="docMainContainer_2iGs"><div class="container padding-vert--lg docItemWrapper_1bxp"><div class="row"><div class="col docItemCol_U38p"><div class="docItemContainer_a7m4"><article><header><h1 class="docTitle_Oumm">Protocol Buffer Tutorial: Scala</h1></header><div class="markdown"><p>This tutorial provides a basic Scala programmer&#x27;s introduction to working with protocol buffers. By walking through creating a simple example application, it shows you how to</p><ul><li><p>Define message formats in a .proto file.</p></li><li><p>Use SBT to generate Scala case classes from proto files.</p></li><li><p>Use ScalaPB&#x27;s API to write and read messages.</p></li></ul><p>This isn&#x27;t a comprehensive guide to using protocol buffers in Scala. For more detailed reference information, see the <a href="/docs/generated-code">Generated Code page</a>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="why-use-protocol-buffers"></a>Why Use Protocol Buffers?<a class="hash-link" href="#why-use-protocol-buffers" title="Direct link to heading">#</a></h2><p>The example we&#x27;re going to use is a very simple &quot;address book&quot; application that can read and write people&#x27;s contact details to and from a file. Each person in the address book has a name, an ID, an email address, and a contact phone number.</p><p>How do you serialize and retrieve structured data like this? There are a few ways to solve this problem:</p><ul><li>Use Java Serialization. This is the default approach since it&#x27;s built into the language, but it has a host of well-known problems (see Effective Java, by Josh Bloch pp. 213), and also doesn&#x27;t work very well if you need to share data with applications written in C++ or Python.</li><li>You can invent an ad-hoc way to encode the data items into a single string â€“ such as encoding 4 ints as &quot;12:3:-23:67&quot;. This is a simple and flexible approach, although it does require writing one-off encoding and parsing code, and the parsing imposes a small run-time cost. This works best for encoding very simple data.</li><li>Serialize the data to JSON (or XML). This approach can be very attractive since JSON and XML are (sort of) human readable and there are plenty of libraries for lots of languages. This can be a good choice if you want to share data with other applications/projects. However, JSON and XML are notoriously space intensive, and encoding/decoding it can impose a huge performance penalty on applications. Also, navigating JSON AST trees or XML DOM trees is considerably more complicated than navigating simple fields in a case class normally would be.</li></ul><p>Protocol buffers are the flexible, efficient, automated solution to solve exactly this problem. With protocol buffers, you write a <code>.proto</code> description of the data structure you wish to store. From that, the protocol buffer compiler creates a case class that implements automatic encoding and parsing of the protocol buffer data with an efficient binary format. Importantly, the protocol buffer format supports the idea of extending the format over time in such a way that the code can still read data encoded with the old format.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="where-to-find-the-example-code"></a>Where to Find the Example Code<a class="hash-link" href="#where-to-find-the-example-code" title="Direct link to heading">#</a></h2><p>The example code for this tutorial is under the <code>examples/basic</code> directory
in ScalaPB&#x27;s repo. To get your copy:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-bash codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#403f53;background-color:#FBFBFB"><div class="token-line" style="color:#403f53"><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">git</span><span class="token plain"> clone https://github.com/scalapb/ScalaPB.git</span></div><div class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(17, 17, 17)">cd</span><span class="token plain"> examples/basic</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="defining-your-protocol-format"></a>Defining Your Protocol Format<a class="hash-link" href="#defining-your-protocol-format" title="Direct link to heading">#</a></h2><p>By default, all proto files under <code>src/main/protobuf</code> will be compiled to Scala case classes. The following example <code>.proto</code> file resides in <code>src/main/protobuf/addressbook.proto</code>.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-protobuf codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#403f53;background-color:#FBFBFB"><div class="token-line" style="color:#403f53"><span class="token plain">syntax = &quot;proto2&quot;;</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">package tutorial;</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">message Person {</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  required string name = 1;</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  required int32 id = 2;</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  optional string email = 3;</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  enum PhoneType {</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    MOBILE = 0;</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    HOME = 1;</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    WORK = 2;</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  }</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  message PhoneNumber {</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    required string number = 1;</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    optional PhoneType type = 2 [default = HOME];</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  }</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  repeated PhoneNumber phones = 4;</span></div><div class="token-line" style="color:#403f53"><span class="token plain">}</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">message AddressBook {</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  repeated Person people = 1;</span></div><div class="token-line" style="color:#403f53"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Let&#x27;s go through each part of the file and see what it does.</p><p>The <code>.proto</code> file starts with a package declaration, which helps to prevent naming conflicts between different projects. In Scala, the package name followed by the file name is used as the Scala package unless you have either explicitly specified a java_package, or specified a <a href="/docs/customizations">scala package option</a>.</p><p>Next, you have your message definitions. A message is just an aggregate containing a set of typed fields. Many standard simple data types are available as field types, including <code>bool</code>, <code>int32</code>, <code>float</code>, <code>double</code>, and <code>string</code>. You can also add further structure to your messages by using other message types as field types â€“ in the above example the <code>Person</code> message contains <code>PhoneNumber</code> messages, while the <code>AddressBook</code> message contains <code>Person</code> messages. You can even define message types nested inside other messages â€“ as you can see, the <code>PhoneNumber</code> type is defined inside <code>Person</code>. You can also define <code>enum</code> types if you want one of your fields to have one of a predefined list of values â€“ here you want to specify that a phone number can be one of <code>MOBILE</code>, <code>HOME</code>, or <code>WORK</code>.</p><p>The <code>&quot; = 1&quot;</code>, <code>&quot; = 2&quot;</code> markers on each element identify the unique &quot;tag&quot; that field uses in the binary encoding. Tag numbers 1-15 require one less byte to encode than higher numbers, so as an optimization you can decide to use those tags for the commonly used or repeated elements, leaving tags 16 and higher for less-commonly used optional elements. Each element in a repeated field requires re-encoding the tag number, so repeated fields are particularly good candidates for this optimization.</p><p>Each field must be annotated with one of the following modifiers:</p><ul><li><strong><code>required</code></strong>: a value for the field must be provided when constructing a message case class. Parsing a message that misses a required field will throw an <code>InvalidProtocolBufferException</code>. Other than this, a required field behaves exactly like an optional field.</li><li><strong><code>optional</code></strong>: the field may or may not be set. If an optional field value isn&#x27;t set, a default value is used. For simple types, you can specify your own default value, as we&#x27;ve done for the phone number type in the example. Otherwise, a system default is used: zero for numeric types, the empty string for strings, false for bools. For embedded messages, the default value is always the &quot;default instance&quot; or &quot;prototype&quot; of the message, which has none of its fields set. Calling the accessor to get the value of an optional (or required) field which has not been explicitly set always returns that field&#x27;s default value. In proto2, optional fields are represented as <code>Option[]</code>. In proto3, optional primitives are not wrapped in <code>Option[]</code>, but messages are.</li><li><strong><code>repeated</code></strong>: the field may be repeated any number of times (including zero). The order of the repeated values will be preserved in the protocol buffer. Think of repeated fields as dynamically sized arrays. They are represented in Scala as <code>Seq</code>s.</li></ul><blockquote><p><strong>Required Is Forever</strong>. You should be very careful about marking fields as required. If at some point you wish to stop writing or sending a required field, it will be problematic to change the field to an optional field â€“ old readers will consider messages without this field to be incomplete and may reject or drop them unintentionally. You should consider writing application-specific custom validation routines for your buffers instead. Some engineers at Google have come to the conclusion that using required does more harm than good; they prefer to use only optional and repeated. However, this view is not universal.</p></blockquote><p>You&#x27;ll find a complete guide to writing <code>.proto</code> files â€“ including all the possible field types â€“ in the <a href="https://developers.google.com/protocol-buffers/docs/proto" target="_blank" rel="noopener noreferrer">Protocol Buffer Language Guide</a>. Don&#x27;t go looking for facilities similar to class inheritance, though â€“ protocol buffers don&#x27;t do that.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="compiling-your-protocol-buffers"></a>Compiling Your Protocol Buffers<a class="hash-link" href="#compiling-your-protocol-buffers" title="Direct link to heading">#</a></h2><p>Start <code>sbt</code> and type <code>compile</code> to compile the tutorial project.</p><p>Now, take a look at the files that were generated under
<code>target/scala-2.13/src_managed/main/scalapb/com/example/tutorial/addressbook</code>:</p><p>You will find <code>Person.scala</code>, with a case class that conceptually looks like this:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-scala codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#403f53;background-color:#FBFBFB"><div class="token-line" style="color:#403f53"><span class="token plain">final case class Person(</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    name: String,</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    id: Int,</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    email: Option[String] = None,</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    phones: Seq[PhoneNumber] = Seq.empty,</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    ...</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>The actual generated code will contain fully qualified class names (such as <code>_root_.scala.Predef.String</code>) to prevent name collissions between entities defined in your protocol buffer and other Scala code.</p><p>As you can see, each protobuf field becomes a member in the generated case class.</p><p>Repeated fields, by default, have a <code>Seq[T]</code> type. When they are parsed, the runtime type would be a <code>Vector</code>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="enums"></a>Enums<a class="hash-link" href="#enums" title="Direct link to heading">#</a></h2><p>The enum <code>PhoneType</code> is represented as a sealed abstract class, extended by a case object for each possible enum value:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-scala codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#403f53;background-color:#FBFBFB"><div class="token-line" style="color:#403f53"><span class="token plain">sealed abstract class PhoneType(val value: Int)</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    extends _root_.scalapb.GeneratedEnum {</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  type EnumType = PhoneType</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  def isMobile: Boolean = false</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  def isHome: Boolean = false</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  def isWork: Boolean = false</span></div><div class="token-line" style="color:#403f53"><span class="token plain">}</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">object PhoneType {</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  case object MOBILE extends PhoneType(0) {</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    val index = 0</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    val name = &quot;MOBILE&quot;</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    override def isMobile: Boolean = true</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  }</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  case object HOME extends PhoneType(1) {</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    val index = 1</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    val name = &quot;HOME&quot;</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    override def isMobile: Boolean = true</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  }</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  // ...</span></div><div class="token-line" style="color:#403f53"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Since Scala type equality is not type-safe (<code>a == b</code> will compile even when
<code>a</code> and <code>b</code> are of types that can never be equal), it is recommended to use
the various <code>isX</code> methods or pattern matching for comparison:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-scala codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#403f53;background-color:#FBFBFB"><div class="token-line" style="color:#403f53"><span class="token plain">// Using isX:</span></div><div class="token-line" style="color:#403f53"><span class="token plain">val t = if (phoneType.isMobile) &quot;Mobile&quot; else &quot;Not Mobile&quot;</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">// Using pattern matching</span></div><div class="token-line" style="color:#403f53"><span class="token plain">phoneType match {</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  case PhoneType.MOBILE =&gt; println(&quot;Mobile!&quot;)</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  case _                =&gt; println(&quot;Not mobile!&quot;)</span></div><div class="token-line" style="color:#403f53"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="nested-messages"></a>Nested messages<a class="hash-link" href="#nested-messages" title="Direct link to heading">#</a></h2><p>Nested messages appear as case classes inside the companion object of
the containing message.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="serialization"></a>Serialization<a class="hash-link" href="#serialization" title="Direct link to heading">#</a></h2><p>Each message case class extends a base trait called <code>GeneratedMessage</code> which provides
methods that help serialize a message:</p><ul><li><code>def toByteArray: Array[Byte]</code>: serializes the message and return a byte array containing its raw bytes.</li><li><code>def writeTo(output: OutputStream): Unit</code>: serializes the message and writes it to an <code>OutputStream</code>.</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="parsing"></a>Parsing<a class="hash-link" href="#parsing" title="Direct link to heading">#</a></h2><p>The companion object of each message extends a base trait called <code>GeneratedMessageCompanion[A]</code> where <code>A</code> is the type of the message. It provides many
useful methods that helps dealing with a message in a generic way, however the primary use is parsing:</p><ul><li><code>def parseFrom(input: InputStream): A</code>: reads and parses a message from an <code>InputStream</code>.</li><li><code>def parseFrom(s: Array[Byte]): A</code>: parses a message from the given byte array.</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="parsing-from-an-input-stream"></a>Parsing from an input stream<a class="hash-link" href="#parsing-from-an-input-stream" title="Direct link to heading">#</a></h2><p>The following example code loads binary data from a file and parses it as an <code>AddressBook</code>. If the file doesn&#x27;t exist it returns an empty <code>AddressBook</code>:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-scala codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#403f53;background-color:#FBFBFB"><div class="token-line" style="color:#403f53"><span class="token plain">def readFromFile(): AddressBook =</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  Using(new FileInputStream(&quot;addressbook.pb&quot;)) { fileInputStream =&gt;</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    AddressBook.parseFrom(fileInputStream)</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  }.recover {</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    case _: FileNotFoundException =&gt;</span></div><div class="token-line" style="color:#403f53"><span class="token plain">      println(&quot;No address book found. Will create a new file.&quot;)</span></div><div class="token-line" style="color:#403f53"><span class="token plain">      AddressBook()</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  }.get</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="adding-new-person"></a>Adding new person<a class="hash-link" href="#adding-new-person" title="Direct link to heading">#</a></h2><p>The following code prompts the user to enter a person&#x27;s data. It then loads
the address book from a file, adds the new person to the list, and saves it again:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-scala codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#403f53;background-color:#FBFBFB"><div class="token-line" style="color:#403f53"><span class="token plain">def personFromStdin(): Person = {</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  print(&quot;Enter person ID (int): &quot;)</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  val id = StdIn.readInt()</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  print(&quot;Enter name: &quot;)</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  val name = StdIn.readLine()</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  print(&quot;Enter email address (blank for none): &quot;)</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  val email = StdIn.readLine()</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  def getPhone(): Option[Person.PhoneNumber] = {</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    print(&quot;Enter a phone number (or leave blank to finish): &quot;)</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    val number = StdIn.readLine()</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    if (number.nonEmpty) {</span></div><div class="token-line" style="color:#403f53"><span class="token plain">      print(&quot;Is this a mobile, home, or work phone [mobile, home, work] ? &quot;)</span></div><div class="token-line" style="color:#403f53"><span class="token plain">      val typ = StdIn.readLine() match {</span></div><div class="token-line" style="color:#403f53"><span class="token plain">        case &quot;mobile&quot; =&gt; Some(Person.PhoneType.MOBILE)</span></div><div class="token-line" style="color:#403f53"><span class="token plain">        case &quot;home&quot;   =&gt; Some(Person.PhoneType.HOME)</span></div><div class="token-line" style="color:#403f53"><span class="token plain">        case &quot;work&quot;   =&gt; Some(Person.PhoneType.WORK)</span></div><div class="token-line" style="color:#403f53"><span class="token plain">        case _ =&gt;</span></div><div class="token-line" style="color:#403f53"><span class="token plain">          println(&quot;Unknown phone type. Leaving as None.&quot;)</span></div><div class="token-line" style="color:#403f53"><span class="token plain">          None</span></div><div class="token-line" style="color:#403f53"><span class="token plain">      }</span></div><div class="token-line" style="color:#403f53"><span class="token plain">      Some(Person.PhoneNumber(number = number, `type` = typ))</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    } else None</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  }</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  // Keep prompting for phone numbers until None is returned.</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  val phones =</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    Iterator</span></div><div class="token-line" style="color:#403f53"><span class="token plain">      .continually(getPhone())</span></div><div class="token-line" style="color:#403f53"><span class="token plain">      .takeWhile(_.nonEmpty)</span></div><div class="token-line" style="color:#403f53"><span class="token plain">      .flatten</span></div><div class="token-line" style="color:#403f53"><span class="token plain">      .toSeq</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  Person(</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    id = id,</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    name = name,</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    email = if (email.nonEmpty) Some(email) else None,</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    phones = phones</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  )</span></div><div class="token-line" style="color:#403f53"><span class="token plain">}</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">def addPerson(): Unit = {</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  val newPerson = personFromStdin()</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  val addressBook = readFromFile()</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  // Append the new person to the people list field</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  val updated = addressBook.update(</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    _.people :+= newPerson</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  )</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  Using(new FileOutputStream(&quot;addressbook.pb&quot;)) { output =&gt;</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    updated.writeTo(output)</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  }</span></div><div class="token-line" style="color:#403f53"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="running-the-example"></a>Running the example<a class="hash-link" href="#running-the-example" title="Direct link to heading">#</a></h2><p>In sbt, type <code>run</code></p><blockquote><p>This document, &quot;Protocol Buffer Tutorial: Scala&quot; is a modification of <a href="https://developers.google.com/protocol-buffers/docs/javatutorial" target="_blank" rel="noopener noreferrer">&quot;Protocol Buffer Basics: Java&quot;</a>, which is a work created and <a href="https://developers.google.com/terms/site-policies" target="_blank" rel="noopener noreferrer">shared by Google</a>  and used according to terms described in the <a href="https://creativecommons.org/licenses/by/4.0/" target="_blank" rel="noopener noreferrer">Creative Commons 4.0 Attribution License</a>.</p></blockquote></div></article><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/installation"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Installing ScalaPB</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/customizations"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Customizations Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#why-use-protocol-buffers" class="table-of-contents__link">Why Use Protocol Buffers?</a></li><li><a href="#where-to-find-the-example-code" class="table-of-contents__link">Where to Find the Example Code</a></li><li><a href="#defining-your-protocol-format" class="table-of-contents__link">Defining Your Protocol Format</a></li><li><a href="#compiling-your-protocol-buffers" class="table-of-contents__link">Compiling Your Protocol Buffers</a></li><li><a href="#enums" class="table-of-contents__link">Enums</a></li><li><a href="#nested-messages" class="table-of-contents__link">Nested messages</a></li><li><a href="#serialization" class="table-of-contents__link">Serialization</a></li><li><a href="#parsing" class="table-of-contents__link">Parsing</a></li><li><a href="#parsing-from-an-input-stream" class="table-of-contents__link">Parsing from an input stream</a></li><li><a href="#adding-new-person" class="table-of-contents__link">Adding new person</a></li><li><a href="#running-the-example" class="table-of-contents__link">Running the example</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/">Introduction</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/installation">Installation</a></li><li class="footer__item"><a href="https://scalapb.github.io/api/scalapb" target="_blank" rel="noopener noreferrer" class="footer__link-item">ScalaDoc</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/scalapb" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow</a></li><li class="footer__item"><a href="https://gitter.im/ScalaPB/community" target="_blank" rel="noopener noreferrer" class="footer__link-item">Gitter</a></li><li class="footer__item"><a href="https://groups.google.com/g/scalapb" target="_blank" rel="noopener noreferrer" class="footer__link-item">Google Groups</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/scalapb/ScalaPB" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2014-2021, <a href="https://www.linkedin.com/in/nadav-samet/">Nadav Samet</a></div></div></div></footer></div>
<script src="/styles.e145afce.js"></script>
<script src="/runtime~main.4f711bfc.js"></script>
<script src="/main.0fd1eac8.js"></script>
<script src="/1.d720bdf5.js"></script>
<script src="/2.5b37da85.js"></script>
<script src="/49.555e99e2.js"></script>
<script src="/50.7731d502.js"></script>
<script src="/935f2afb.5e094e5e.js"></script>
<script src="/17896441.4206d928.js"></script>
<script src="/63f1a026.202b3e00.js"></script>
</body>
</html>