<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="ScalaPB Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="ScalaPB Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-346180-20","auto"),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script><title data-react-helmet="true">Generated Code | ScalaPB</title><meta data-react-helmet="true" property="og:image" content="https://scalapb.github.io/img/scalapb-social-light.png"><meta data-react-helmet="true" name="twitter:image" content="https://scalapb.github.io/img/scalapb-social-light.png"><meta data-react-helmet="true" name="twitter:image:alt" content="Image for ScalaPB"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Generated Code | ScalaPB"><meta data-react-helmet="true" name="description" content="This page describes the code generated by ScalaPB and how to use it."><meta data-react-helmet="true" property="og:description" content="This page describes the code generated by ScalaPB and how to use it."><meta data-react-helmet="true" property="og:url" content="https://scalapb.github.io//docs/generated-code"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://scalapb.github.io//docs/generated-code"><link rel="stylesheet" href="/styles.0bbc50d2.css">
<link rel="preload" href="/styles.022ff8f0.js" as="script">
<link rel="preload" href="/runtime~main.8bd17d8e.js" as="script">
<link rel="preload" href="/main.769d31ef.js" as="script">
<link rel="preload" href="/1.d1f2961e.js" as="script">
<link rel="preload" href="/2.f4df6e70.js" as="script">
<link rel="preload" href="/49.50d7d611.js" as="script">
<link rel="preload" href="/50.a4265ab1.js" as="script">
<link rel="preload" href="/935f2afb.5b2cd0a8.js" as="script">
<link rel="preload" href="/17896441.4580ba69.js" as="script">
<link rel="preload" href="/d0d9f8e7.8a2fee4e.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img src="/img/ScalaPB.png" alt="ScalaPB" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/ScalaPB.png" alt="ScalaPB" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Docs</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/scalapb/ScalaPB" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/ScalaPB.png" alt="ScalaPB" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/ScalaPB.png" alt="ScalaPB" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/docs/">Docs</a></li><li class="menu__list-item"><a href="https://github.com/scalapb/ScalaPB" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_vMrn"><div class="docSidebarContainer_3Ak5" role="complementary"><div class="sidebar_3gvy"><div class="menu menu--responsive thin-scrollbar menu_1yIk"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_1CUI" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menuLinkText_yu3-">Getting Started</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/installation">Installation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/getting-started">Tutorial</a></li></ul></li><li class="menu__list-item"><a class="menu__link menuLinkText_yu3-">Customizing</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/customizations">Customizations</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sbt-settings">SBT Settings</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/transformations">Transformations</a></li></ul></li><li class="menu__list-item"><a class="menu__link menuLinkText_yu3-">Guides</a><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/generated-code">Generated Code</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sealed-oneofs">Sealed oneofs</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/user_defined_options">User-defined options</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/grpc">gRPC</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/scala.js">Scala.js</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sparksql">SparkSQL</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/json">JSON</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/scalapbc">ScalaPBC</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/dotty">Dotty</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/third-party-protos">Using third-party protos</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/common-protos">Common protos</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/validation">Validation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/generic">Generic programming</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/writing-plugins">Writing protoc plugins</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/upgrading">Upgrading</a></li></ul></li><li class="menu__list-item"><a class="menu__link menuLinkText_yu3-">Getting Help</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/faq">FAQ</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/contact">Contacting us</a></li></ul></li></ul></div></div></div><main class="docMainContainer_2iGs"><div class="container padding-vert--lg docItemWrapper_1bxp"><div class="row"><div class="col docItemCol_U38p"><div class="docItemContainer_a7m4"><article><header><h1 class="docTitle_Oumm">Generated Code</h1></header><div class="markdown"><p>This page describes the code generated by ScalaPB and how to use it.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="default-package-structure"></a>Default Package Structure<a class="hash-link" href="#default-package-structure" title="Direct link to heading">#</a></h2><p>The generator will create a Scala file for each top-level message and enum
in your proto file. Using multiple files results in a better incremental
compilation performance.</p><p>The Scala package of the generated files will be determined as follows:</p><ul><li>If the <code>java_package</code> option is defined, then the Scala package will be
<code>java_package.base_name</code> where <code>base_name</code> is the name of the proto file
without the <code>.proto</code> extension.</li><li>If the <code>java_package</code> is undefined, but the file specifies a package name
via the <code>package</code> keyword then the Scala package will be
<code>package.base_name</code>.</li><li>If neither <code>java_package</code> nor <code>package</code> are specified, the Scala package
will be just <code>base_name</code>.</li></ul><p>From version 0.4.2, there is a way to customize the package name by using
<a href="/docs/customizations">file-level options</a>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="messages"></a>Messages<a class="hash-link" href="#messages" title="Direct link to heading">#</a></h2><p>Each message corresponds to a final case class and a companion object.
Optional fields are wrapped in an <code>Option[]</code>, repeated fields are given as
<code>Seq[]</code>, and required fields (which you should not use, see &quot;Required is
forever&quot; in the <a href="https://developers.google.com/protocol-buffers/docs/proto#simple" target="_blank" rel="noopener noreferrer">Language
Guide</a> are
normal members.</p><p>Note that in proto3, scalar (non-message) fields are not wrapped in <code>Option</code>,</p><p>For example, if your protocol buffer looks like this:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-protobuf codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#403f53;background-color:#FBFBFB"><div class="token-line" style="color:#403f53"><span class="token plain">message Person {</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    optional string name = 1;</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    optional int32 age = 2;</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    repeated Address addresses = 3;</span></div><div class="token-line" style="color:#403f53"><span class="token plain">}</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">message Address {</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  optional string street = 1;</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  optional string city = 2;</span></div><div class="token-line" style="color:#403f53"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>...then the compiler will generate code that looks like this:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-scala codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#403f53;background-color:#FBFBFB"><div class="token-line" style="color:#403f53"><span class="token plain">final case class Person(</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    name: Option[String] = None,</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    age: Option[Int] = None,</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    addresses: Seq[Address] = Nil, ...) extends GeneratedMessage {</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    def toByteArray: Array[Byte] = { ... }</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    // more stuff...</span></div><div class="token-line" style="color:#403f53"><span class="token plain">}</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">object Person extends GeneratedMessageCompanion[Person] {</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    def parseFrom(bytes: Array[Byte]): Person = { ... }</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    // more stuff...</span></div><div class="token-line" style="color:#403f53"><span class="token plain">}</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">// similar stuff for Address...</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>The case class contains various methods for serialization, and the companion
object contains method for parsing. <a href="https://github.com/scalapb/ScalaPB/blob/master/scalapb-runtime/src/main/scala/scalapb/GeneratedMessageCompanion.scala" target="_blank" rel="noopener noreferrer">See the source code for
<code>GeneratedMessage</code> and
<code>GeneratedMessageCompanion</code></a>
to see what methods are available</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="building-new-messages"></a>Building New Messages<a class="hash-link" href="#building-new-messages" title="Direct link to heading">#</a></h3><p>Create a new instance of a message by calling the constructor (as you normally
would for a case class):</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-scala codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#403f53;background-color:#FBFBFB"><div class="token-line" style="color:#403f53"><span class="token plain">val p1 = Person()</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">val p2 = Person(name = Some(&quot;John&quot;))</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>When constructing messages, it is advised to use named arguments
Person(<strong>name</strong> = x, <strong>age</strong> = y) to ensure your code does not rely on the
order of the fields in the protocol buffer definition.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="updating-messages"></a>Updating Messages<a class="hash-link" href="#updating-messages" title="Direct link to heading">#</a></h3><p>Messages are immutables: once you created a message instance it can not be
changed. Messages are thread-safe: you can access the same message instance
from multiple threads.</p><p>When you want to modify a message, simply create a new one based on the
original. You can use the <code>copy()</code> method Scala provides for all case classes,
however ScalaPB provides additional methods to make it even easier.</p><p>The first method is using a <code>withX()</code> method, where <code>X</code> is a name of a field.
For example</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-scala codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#403f53;background-color:#FBFBFB"><div class="token-line" style="color:#403f53"><span class="token plain">val p = Person().withName(&quot;John&quot;).withAge(29)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Note that when using the <code>withX()</code> method on an optional field, you do not
need to provide the <code>Some()</code>.</p><p>Another way to update a message is using the <code>update()</code> method:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-scala codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#403f53;background-color:#FBFBFB"><div class="token-line" style="color:#403f53"><span class="token plain">val p = Person().update(</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  _.name := &quot;John&quot;,</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  _.age := 29</span></div><div class="token-line" style="color:#403f53"><span class="token plain">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>The <code>update()</code> method takes &quot;mutations&quot; (like the assignments above), and
applies them on the object.  Using the <code>update()</code> method, as we will see
below, usually results in a more concise code, especially when your fields are
message types.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="optional-fields"></a>Optional Fields<a class="hash-link" href="#optional-fields" title="Direct link to heading">#</a></h2><p>Optional fields are wrapped inside an <code>Option</code>.  The compiler will generate a
<code>getX()</code> method that will return the option&#x27;s value if it is set, or a
default value for the field if it is unset (that is, if it is <code>None</code>)</p><p>There are two ways to update an optional field using the <code>update()</code> method:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-scala codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#403f53;background-color:#FBFBFB"><div class="token-line" style="color:#403f53"><span class="token plain">val p = Person().update(</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  // Pass the value directly:</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  _.name := &quot;John&quot;,</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  // Use the optionalX prefix and pass an Option:</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  _.optionalAge := Some(37)  // ...or None</span></div><div class="token-line" style="color:#403f53"><span class="token plain">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>The first way sets the field with a value, the second way lets you pass an
<code>Option[]</code> so it is possible to set the field to <code>None</code>.</p><p>For each optional field <code>X</code>, the compiler also generates a <code>clearX()</code> method
that returns a new instance of the message which is identical to the original
one except that the field is assigned the value <code>None</code>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="required-fields"></a>Required Fields<a class="hash-link" href="#required-fields" title="Direct link to heading">#</a></h2><p>Required fields have no default value in the generated constructor, so you
must specify them when you instantiate a new message. Differences from
optional fields:</p><ul><li>The value of the field is not wrapped inside an <code>Option</code>.</li><li>There is no <code>getX</code> method (you can always use <code>.x</code>)</li><li>There is no <code>clearX</code> method (since that will result in an invalid message)</li><li>There is no <code>_.optionalX</code> lens for the <code>update()</code> method.</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="repeated-fields"></a>Repeated Fields<a class="hash-link" href="#repeated-fields" title="Direct link to heading">#</a></h2><p>Repeated fields are provided as a <code>Seq[T]</code>. The compiler will generate the
following methods:</p><ul><li><code>addFoo(f1, [f2, f3, ...]: Foo)</code>: returns a copy with the given elements added to the
original list.</li><li><code>addAllFoo(fs: Seq[Foo])</code>: returns a copy with the given sequence of
elements added to the original list.</li><li><code>withX(otherList)</code>: replace the sequence with another.</li><li><code>clearX</code>: replace with the sequence with an empty one.</li></ul><p>Using <code>update()</code> is especially fun with repeated fields:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-scala codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#403f53;background-color:#FBFBFB"><div class="token-line" style="color:#403f53"><span class="token plain">val p = Person().update(</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  // Override the addresses</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  _.addresses := newListOfAddress,</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  // Add one address:</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  _.addresses :+= address1,</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  // Add a list of addresses:</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  _.addresses :++= Seq(address1, address2),</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  // Modify an address in the list by index!</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  _.addresses(1).street := &quot;Townsend St.&quot;,</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  // Modify all addresses:</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  _.addresses.foreach(_.city := &quot;San Francisco&quot;),</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  // Apply a transformation to all addresses (this is</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  // just for showing off, it is not specific for</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  // repeatables - it happens in the nested mutations)</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  _.addresses.foreach(_.city.modify(_.trim))</span></div><div class="token-line" style="color:#403f53"><span class="token plain">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="oneof-fields"></a>Oneof Fields<a class="hash-link" href="#oneof-fields" title="Direct link to heading">#</a></h2><p>Oneofs are great when you model a message that has multiple disjoint cases. An
example use case would be:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-protobuf codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#403f53;background-color:#FBFBFB"><div class="token-line" style="color:#403f53"><span class="token plain">// Represent a payment by credit card</span></div><div class="token-line" style="color:#403f53"><span class="token plain">message CreditCardPayment {</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    optional string last4 = 1;</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    optional int32 expiration_month = 2;</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    optional int32 expiration_year = 3;</span></div><div class="token-line" style="color:#403f53"><span class="token plain">}</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">// Represent a payment by credit card</span></div><div class="token-line" style="color:#403f53"><span class="token plain">message BankTransferPayment {</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    optional string routing_number = 1;</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    optional string account_number = 2;</span></div><div class="token-line" style="color:#403f53"><span class="token plain">}</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">// Represents an order placed by a customer:</span></div><div class="token-line" style="color:#403f53"><span class="token plain">message Order {</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    optional int32 amount = 1;</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    optional string customer_id = 2;</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    // How did we get paid? At most one option must be set.</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    oneof payment_type {</span></div><div class="token-line" style="color:#403f53"><span class="token plain">        CreditCardPayment credit_card = 3;</span></div><div class="token-line" style="color:#403f53"><span class="token plain">        BankTransferPayment bank = 4;</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    }</span></div><div class="token-line" style="color:#403f53"><span class="token plain">}</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>The compiler will generate code that looks like this:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-scala codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#403f53;background-color:#FBFBFB"><div class="token-line" style="color:#403f53"><span class="token plain">final case class CreditCardPayment { ... }</span></div><div class="token-line" style="color:#403f53"><span class="token plain">final case class BankTransfer { ... }</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">case class Order(..., paymentType: Payment.PaymentType) {</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    // Set the payment type to a specific case:</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    def withCreditCard(v: CreditCardPayment): Order</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    def withBank(v: BankTransferPayment): Order</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    // Sets the entire payment type to a new value:</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    def withPaymentType(v: PaymentType): Order</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    // Sets the PaymentType to Empty</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    def clearPaymentType: Order</span></div><div class="token-line" style="color:#403f53"><span class="token plain">}</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">object Order {</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    sealed trait PaymentType {</span></div><div class="token-line" style="color:#403f53"><span class="token plain">        def isEmpty: Boolean</span></div><div class="token-line" style="color:#403f53"><span class="token plain">        def isDefined: Boolean</span></div><div class="token-line" style="color:#403f53"><span class="token plain">        def isCreditCard: Boolean</span></div><div class="token-line" style="color:#403f53"><span class="token plain">        def isBank: Boolean</span></div><div class="token-line" style="color:#403f53"><span class="token plain">        def creditCard: Option[CreditCardPayment]</span></div><div class="token-line" style="color:#403f53"><span class="token plain">        def bank: Option[BankTransferPayment]</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    }</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    case object Empty extends PaymentType</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    case class CreditCard(v: CreditCardPayment) extends PaymentType</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    case class Bank(v: CreditCardPayment) extends PaymentType</span></div><div class="token-line" style="color:#403f53"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>This enables writing coding like this:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-scala codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#403f53;background-color:#FBFBFB"><div class="token-line" style="color:#403f53"><span class="token plain">val o1 = Order()</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  .withCreditCard(CreditCardPayment(last4 = Some(&quot;4848&quot;)))</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">// which is equivalent to:</span></div><div class="token-line" style="color:#403f53"><span class="token plain">val o2 = Order().update(</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  _.creditCard.last4 := &quot;4848&quot;)</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">// This changes the payment type to a bank, so the credit card data is</span></div><div class="token-line" style="color:#403f53"><span class="token plain">// not reachable any more through o3.</span></div><div class="token-line" style="color:#403f53"><span class="token plain">val o3 = o1.update(_.bank.routingNumber := &quot;333&quot;)</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">if (o3.paymentType.isBank) {</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  // Do something useful.</span></div><div class="token-line" style="color:#403f53"><span class="token plain">}</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">// Pattern matching:</span></div><div class="token-line" style="color:#403f53"><span class="token plain">import Order.PaymentType</span></div><div class="token-line" style="color:#403f53"><span class="token plain">o3.paymentType match {</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    case PaymentType.CreditCard(cc) =&gt;  // handle cc</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    case PaymentType.Bank(b) =&gt;  // handle b</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    case PaymentType.Empty =&gt;  // handle exceptional case...</span></div><div class="token-line" style="color:#403f53"><span class="token plain">}</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">// The one of values are available as Option too:</span></div><div class="token-line" style="color:#403f53"><span class="token plain">val maybeRoutingNumber: Option[String] = o3.paymentType.bank.map {</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    b =&gt; b.routingNumber</span></div><div class="token-line" style="color:#403f53"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="enumerations"></a>Enumerations<a class="hash-link" href="#enumerations" title="Direct link to heading">#</a></h2><p>Enumerations are implemented using sealed traits that extend <code>GeneratedEnum</code>.
This approach, rather than using Scala&#x27;s standard Enumeration type, allows
getting a warning from the Scala compiler when a pattern match is incomplete.</p><p>For a definition like:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-protobuf codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#403f53;background-color:#FBFBFB"><div class="token-line" style="color:#403f53"><span class="token plain">enum Weather {</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    SUNNY = 1;</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    PARTLY_CLOUDY = 2;</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    RAIN = 3;</span></div><div class="token-line" style="color:#403f53"><span class="token plain">}</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">message Forecast {</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    optional Weather weather = 1;</span></div><div class="token-line" style="color:#403f53"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>The compiler will generate:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-scala codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#403f53;background-color:#FBFBFB"><div class="token-line" style="color:#403f53"><span class="token plain">sealed trait Weather extends GeneratedEnum {</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    def isSunny: Boolean</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    def isPartlyCloudy: Boolean</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    def isRain: Boolean</span></div><div class="token-line" style="color:#403f53"><span class="token plain">}</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">object Weather extends GeneratedEnumCompanion[Weather] {</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    case object SUNNY extends Weather {</span></div><div class="token-line" style="color:#403f53"><span class="token plain">        val value = 1</span></div><div class="token-line" style="color:#403f53"><span class="token plain">        val name = &quot;SUNNY&quot;</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    }</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    // Similarly for the other enum values...</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    case object PARTLY_CLOUDY extends Weather { ... }</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    case object RAIN extends Weather { ... }</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    // In ScalaPB &gt;= 0.5.x, this captures unknown value that are received</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    // from the wire format.  Earlier versions throw a MatchError when</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    // this happens.</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    case class Unrecognized(value: Int) extends Weather { ... }</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    // And a list of all possible values:</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    lazy val values = Seq(SUNNY, PARTLY_CLOUDY, RAIN)</span></div><div class="token-line" style="color:#403f53"><span class="token plain">}</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">case class Forecast(weather: Option[Weather]) { ... }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>And we can write:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-scala codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#403f53;background-color:#FBFBFB"><div class="token-line" style="color:#403f53"><span class="token plain">val f = Forecast().update(_.weather := Weather.PARTLY_CLOUDY)</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">assert(f.weather == Some(Weather.PARTLY_CLOUDY)</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">if (f.getWeather.isRain) {</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    // take an umbrella</span></div><div class="token-line" style="color:#403f53"><span class="token plain">}</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">// Pattern matching:</span></div><div class="token-line" style="color:#403f53"><span class="token plain">f.getWeather match {</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    case Weather.RAIN =&gt;</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    case Weather.SUNNY =&gt;</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    case _ =&gt;</span></div><div class="token-line" style="color:#403f53"><span class="token plain">}</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="ascii-representation"></a>ASCII Representation<a class="hash-link" href="#ascii-representation" title="Direct link to heading">#</a></h2><p>Each message case-class has <code>toProtoString</code> method that returns a string
representation of the message in an ASCII format. The ASCII format can be
parsed back by the <code>fromAscii()</code> method available on the companion object.</p><p>That format is not officially documented, but at least the standard Python,
Java and C++ implementations of protobuf attempt to generate (and be able to parse)
compatible ASCII representations. ScalaPB&#x27;s <code>toString()</code> and <code>fromAscii</code>
follow the Java implementation.</p><p>The format looks like this:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-protobuf codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#403f53;background-color:#FBFBFB"><div class="token-line" style="color:#403f53"><span class="token plain">int_field: 17</span></div><div class="token-line" style="color:#403f53"><span class="token plain">string_field: &quot;foo&quot;</span></div><div class="token-line" style="color:#403f53"><span class="token plain">repeated_string_field: &quot;foo&quot;</span></div><div class="token-line" style="color:#403f53"><span class="token plain">repeated_string_field: &quot;bar&quot;</span></div><div class="token-line" style="color:#403f53"><span class="token plain">message_field {</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  field1: &quot;value1&quot;</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  color_enum: BLUE</span></div><div class="token-line" style="color:#403f53"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>This format can be useful for debugging or for transient data processing, but
beware of persisting these ASCII representations: unknown fields throw an
exception, and unlike the binary format, the ASCII format is senstitive to
renames.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="java-conversions"></a>Java Conversions<a class="hash-link" href="#java-conversions" title="Direct link to heading">#</a></h2><p>If you are dealing with legacy Java protocol buffer code, while still wanting
to write new code using ScalaPB, it can be useful to generate converters
to/from the Java protocol buffers. To do this, set <code>Compile / PB.targets</code>
like this in your <code>build.sbt</code>:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-scala codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#403f53;background-color:#FBFBFB"><div class="token-line" style="color:#403f53"><span class="token plain">Compile / PB.targets := Seq(</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  PB.gens.java -&gt; (Compile / sourceManaged).value,</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  scalapb.gen(javaConversions=true) -&gt; (Compile / sourceManaged).value</span></div><div class="token-line" style="color:#403f53"><span class="token plain">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>This will result in the following changes:</p><ul><li>The companion object for each message will have <code>fromJavaProto</code> and
<code>toJavaProto</code> methods.</li><li>The companion object for enums will have <code>fromJavaValue</code> and
<code>toJavaValue</code> methods.</li></ul></div></article><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/transformations"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Transformations</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/sealed-oneofs"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Sealed oneofs Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#default-package-structure" class="table-of-contents__link">Default Package Structure</a></li><li><a href="#messages" class="table-of-contents__link">Messages</a><ul><li><a href="#building-new-messages" class="table-of-contents__link">Building New Messages</a></li><li><a href="#updating-messages" class="table-of-contents__link">Updating Messages</a></li></ul></li><li><a href="#optional-fields" class="table-of-contents__link">Optional Fields</a></li><li><a href="#required-fields" class="table-of-contents__link">Required Fields</a></li><li><a href="#repeated-fields" class="table-of-contents__link">Repeated Fields</a></li><li><a href="#oneof-fields" class="table-of-contents__link">Oneof Fields</a></li><li><a href="#enumerations" class="table-of-contents__link">Enumerations</a></li><li><a href="#ascii-representation" class="table-of-contents__link">ASCII Representation</a></li><li><a href="#java-conversions" class="table-of-contents__link">Java Conversions</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/">Introduction</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/installation">Installation</a></li><li class="footer__item"><a href="https://scalapb.github.io/api/scalapb" target="_blank" rel="noopener noreferrer" class="footer__link-item">ScalaDoc</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/scalapb" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow</a></li><li class="footer__item"><a href="https://gitter.im/ScalaPB/community" target="_blank" rel="noopener noreferrer" class="footer__link-item">Gitter</a></li><li class="footer__item"><a href="https://groups.google.com/g/scalapb" target="_blank" rel="noopener noreferrer" class="footer__link-item">Google Groups</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/scalapb/ScalaPB" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2014-2023, <a href="https://www.linkedin.com/in/nadav-samet/">Nadav Samet</a></div></div></div></footer></div>
<script src="/styles.022ff8f0.js"></script>
<script src="/runtime~main.8bd17d8e.js"></script>
<script src="/main.769d31ef.js"></script>
<script src="/1.d1f2961e.js"></script>
<script src="/2.f4df6e70.js"></script>
<script src="/49.50d7d611.js"></script>
<script src="/50.a4265ab1.js"></script>
<script src="/935f2afb.5b2cd0a8.js"></script>
<script src="/17896441.4580ba69.js"></script>
<script src="/d0d9f8e7.8a2fee4e.js"></script>
</body>
</html>