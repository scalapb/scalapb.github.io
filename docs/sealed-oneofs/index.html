<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.65">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-346180-20","auto"),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script><title data-react-helmet="true">Sealed oneofs | ScalaPB</title><meta data-react-helmet="true" name="docsearch:version" content="current,latest"><meta data-react-helmet="true" property="og:image" content="https://scalapb.github.io/img/scalapb-social-light.png"><meta data-react-helmet="true" property="twitter:image" content="https://scalapb.github.io/img/scalapb-social-light.png"><meta data-react-helmet="true" name="twitter:image:alt" content="Image for ScalaPB"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="Sealed oneofs | ScalaPB"><meta data-react-helmet="true" name="description" content="Note: sealed oneofs are available only in ScalaPB 0.8 or later. The API and rules are considered experimental. See note at the bottom."><meta data-react-helmet="true" property="og:description" content="Note: sealed oneofs are available only in ScalaPB 0.8 or later. The API and rules are considered experimental. See note at the bottom."><meta data-react-helmet="true" property="og:url" content="https://scalapb.github.io//docs/sealed-oneofs"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://scalapb.github.io//docs/sealed-oneofs"><link rel="stylesheet" href="/styles.e69897f8.css">
<link rel="preload" href="/styles.147d50b7.js" as="script">
<link rel="preload" href="/runtime~main.4a02f162.js" as="script">
<link rel="preload" href="/main.42a78eda.js" as="script">
<link rel="preload" href="/1.b05a46e6.js" as="script">
<link rel="preload" href="/2.d79d948e.js" as="script">
<link rel="preload" href="/3.a17994a4.js" as="script">
<link rel="preload" href="/1be78505.22105b21.js" as="script">
<link rel="preload" href="/48.8b731ab4.js" as="script">
<link rel="preload" href="/935f2afb.a4a91e7e.js" as="script">
<link rel="preload" href="/17896441.885479ee.js" as="script">
<link rel="preload" href="/26672fd6.1e786b82.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/ScalaPB.png" alt="ScalaPB"><strong class="navbar__title"></strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Docs</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/scalapb/ScalaPB" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2aTZ"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_BsTx">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_BsTx">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/ScalaPB.png" alt="ScalaPB"><strong class="navbar__title"></strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/docs/">Docs</a></li><li class="menu__list-item"><a href="https://github.com/scalapb/ScalaPB" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><div class="docSidebarContainer_3_JD" role="complementary"><div class="sidebar_2urC"><div class="menu menu--responsive menu_5FrY"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_Dm3K" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menuLinkText_2zSB">Getting Started</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/installation">Installation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/getting-started">Tutorial</a></li></ul></li><li class="menu__list-item"><a class="menu__link menuLinkText_2zSB">Customizing</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/customizations">Customizations</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sbt-settings">SBT Settings</a></li></ul></li><li class="menu__list-item"><a class="menu__link menuLinkText_2zSB">Guides</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/generated-code">Generated Code</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/sealed-oneofs">Sealed oneofs</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/user_defined_options">User-defined options</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/grpc">gRPC</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/scala.js">Scala.js</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sparksql">SparkSQL</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/json">JSON</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/scalapbc">ScalaPBC</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/dotty">Dotty</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/third-party-protos">Using third-party protos</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/common-protos">Common protos</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/validation">Validation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/generic">Generic programming</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/writing-plugins">Writing protoc plugins</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/upgrading">Upgrading</a></li></ul></li><li class="menu__list-item"><a class="menu__link menuLinkText_2zSB">Getting Help</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/faq">FAQ</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/contact">Contacting us</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_1EkI"><div class="row"><div class="col docItemCol_2ASc"><div class="docItemContainer_3QWW"><article><header><h1 class="docTitle_1Lrw">Sealed oneofs</h1></header><div class="markdown"><p><strong>Note: sealed oneofs are available only in ScalaPB 0.8 or later. The API and rules are considered experimental. See note at the bottom. </strong></p><p>Sealed oneofs are a subset of oneofs for which ScalaPB generates idiomatic data types for.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="example"></a>Example<a aria-hidden="true" tabindex="-1" class="hash-link" href="#example" title="Direct link to heading">#</a></h2><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-protobuf codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#403f53;background-color:#FBFBFB"><div class="token-line" style="color:#403f53"><span class="token plain">message Expr {</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    oneof sealed_value {</span></div><div class="token-line" style="color:#403f53"><span class="token plain">        Literal lit = 1;</span></div><div class="token-line" style="color:#403f53"><span class="token plain">        Add add = 2;</span></div><div class="token-line" style="color:#403f53"><span class="token plain">        Mul mul = 3;</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    }</span></div><div class="token-line" style="color:#403f53"><span class="token plain">}</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">message Literal {</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    int32 value = 1;</span></div><div class="token-line" style="color:#403f53"><span class="token plain">}</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">message Add {</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    Expr left = 1;</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    Expr right = 2;</span></div><div class="token-line" style="color:#403f53"><span class="token plain">}</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">message Mul {</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    Expr left = 1;</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    Expr right = 2;</span></div><div class="token-line" style="color:#403f53"><span class="token plain">}</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">message Program {</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    repeated Expr exprs = 1;</span></div><div class="token-line" style="color:#403f53"><span class="token plain">}</span></div></div></div></div></div><p>Note that the name of the oneof name is <code>sealed_value</code>. This is what makes ScalaPB treat <code>Expr</code> as a sealed oneof and generate code similar to the following:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-scala codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#403f53;background-color:#FBFBFB"><div class="token-line" style="color:#403f53"><span class="token plain">sealed trait Expr {</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    def isEmpty: Boolean</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    def isDefined: Boolean</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    def asMessage: ExprMessage  // converts to the standard representation</span></div><div class="token-line" style="color:#403f53"><span class="token plain">}</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">object Expr {</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    case object Empty extends Expr</span></div><div class="token-line" style="color:#403f53"><span class="token plain">}</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">case class Literal(value: Int) extends Expr with GeneratedMessage</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">case class Add(left: Expr, right: Expr) extends Expr with GeneratedMessage</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">case class Mul(left: Expr, right: Expr) extends Expr with GeneratedMessage</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">case class Programs(exprs: Seq[Expr]) extends GeneratedMessage</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">// Standard case class for the Expr message, containing the</span></div><div class="token-line" style="color:#403f53"><span class="token plain">// default style of the code that gets generated for oneofs.</span></div><div class="token-line" style="color:#403f53"><span class="token plain">case class ExprMessage(sealedValue: ExprMessage.SealedValue)</span></div></div></div></div></div><p>The above Scala representation of the protocol buffer is much nicer to work with than the default oneof representation, as there are no wrapper types around each individual case of the oneof. Also note that optional fields of type <code>Expr</code> are not boxed inside an <code>Option</code> since we have <code>Expr.Empty</code> that represents the empty case.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="sealed-oneof-rules"></a>Sealed oneof rules<a aria-hidden="true" tabindex="-1" class="hash-link" href="#sealed-oneof-rules" title="Direct link to heading">#</a></h2><p>A sealed oneof is detected when a message (denoted below as the <em>containing message</em>) contains a oneof named <code>sealed_value</code>. The code generator checks the following rules for each sealed oneof. If any of these rules fail, then the code generator aborts.</p><ol><li><p>The oneof named <code>sealed_value</code> must be the only oneof in the containing message.</p></li><li><p>No additional fields (except those inside <code>sealed_values</code>) may be defined inside the containing message.</p></li><li><p>No nested messages or enums are allowed to be defined in the containing message.</p></li><li><p>All of the oneof cases must be inside the same namespace as the containing message. That is, all messages must either be top-level or direct children of the same parent message.</p></li><li><p>All the oneof cases must defined in the same file as the sealed oneof.</p></li><li><p>A message type can appear in at most one sealed oneof.</p></li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="experimental-status"></a>Experimental Status<a aria-hidden="true" tabindex="-1" class="hash-link" href="#experimental-status" title="Direct link to heading">#</a></h2><p>Some of the rules above are inherently required (for example, that the message types need to be distinct). Other rules, such as the one requesting that all involved messages need to be inside the same namespace, were added to make the implementation simpler. That particular rule helps ensuring that all the cases can be generated into a single Scala source file without changing too much the existing way the code generator works. It is possible that some of the rules will change over time, though most likely they are only going to become less restrictive so existing code does not break.</p><p>Currently, sealed oneofs are implemented as a custom type defined over the old-style container message. This implementation detail is exposed through <code>asMessage</code> which returns the underlying message representing the sealed oneof.  It is possible that in a future version, sealed oneofs would have a direct implementation, and therefore <code>asMessage</code> and its return type should be considered an experimental API.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="optional-sealed-oneof"></a>Optional sealed oneof<a aria-hidden="true" tabindex="-1" class="hash-link" href="#optional-sealed-oneof" title="Direct link to heading">#</a></h2><p>This is a variant of <em>Sealed oneof</em>, where the optionality is expressed differently.
The <code>Empty</code> case is not generated, but instead the sealed trait is put in other classes as <code>Option[_]</code>, not directly.
To create an optional sealed oneof, name the oneof sealed_value_optional as in the example below:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-protobuf codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#403f53;background-color:#FBFBFB"><div class="token-line" style="color:#403f53"><span class="token plain">message Expr {</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    oneof sealed_value_optional {</span></div><div class="token-line" style="color:#403f53"><span class="token plain">        Literal lit = 1;</span></div><div class="token-line" style="color:#403f53"><span class="token plain">        Add add = 2;</span></div><div class="token-line" style="color:#403f53"><span class="token plain">        Mul mul = 3;</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    }</span></div><div class="token-line" style="color:#403f53"><span class="token plain">}</span></div></div></div></div></div><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-scala codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#403f53;background-color:#FBFBFB"><div class="token-line" style="color:#403f53"><span class="token plain">sealed trait Expr {</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    def isEmpty: Boolean</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    def isDefined: Boolean</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    def asMessage: ExprMessage  // converts to the standard representation</span></div><div class="token-line" style="color:#403f53"><span class="token plain">}</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">case class Literal(value: Int) extends Expr with GeneratedMessage</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">case class Add(left: Option[Expr], right: Option[Expr]) extends Expr with GeneratedMessage</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">case class Mul(left: Option[Expr], right: Option[Expr]) extends Expr with GeneratedMessage</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">case class Programs(exprs: Seq[Option[Expr]]) extends GeneratedMessage</span></div></div></div></div></div></div></article><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/generated-code"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Generated Code</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/user_defined_options"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Defining custom options Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3SO_"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#example" class="table-of-contents__link">Example</a></li><li><a href="#sealed-oneof-rules" class="table-of-contents__link">Sealed oneof rules</a></li><li><a href="#experimental-status" class="table-of-contents__link">Experimental Status</a></li><li><a href="#optional-sealed-oneof" class="table-of-contents__link">Optional sealed oneof</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/">Introduction</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/installation">Installation</a></li><li class="footer__item"><a href="https://scalapb.github.io/api/scalapb" target="_blank" rel="noopener noreferrer" class="footer__link-item">ScalaDoc</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/scalapb" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow</a></li><li class="footer__item"><a href="https://gitter.im/ScalaPB/community" target="_blank" rel="noopener noreferrer" class="footer__link-item">Gitter</a></li><li class="footer__item"><a href="https://groups.google.com/g/scalapb" target="_blank" rel="noopener noreferrer" class="footer__link-item">Google Groups</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/scalapb/ScalaPB" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="text--center"><div>Copyright Â© 2014-2020, <a href="https://www.linkedin.com/in/nadav-samet/">Nadav Samet</a></div></div></div></footer></div>
<script src="/styles.147d50b7.js"></script>
<script src="/runtime~main.4a02f162.js"></script>
<script src="/main.42a78eda.js"></script>
<script src="/1.b05a46e6.js"></script>
<script src="/2.d79d948e.js"></script>
<script src="/3.a17994a4.js"></script>
<script src="/1be78505.22105b21.js"></script>
<script src="/48.8b731ab4.js"></script>
<script src="/935f2afb.a4a91e7e.js"></script>
<script src="/17896441.885479ee.js"></script>
<script src="/26672fd6.1e786b82.js"></script>
</body>
</html>