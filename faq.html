<!DOCTYPE html><html><head><title>ScalaPB: FAQ</title><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Nadav Samet" /><meta name="description" content="Protocol buffer compiler for Scala" /><meta name="og:image" content="/img/poster.png" /><meta name="image" property="og:image" content="/img/poster.png" /><meta name="og:title" content="ScalaPB: FAQ" /><meta name="title" property="og:title" content="ScalaPB: FAQ" /><meta name="og:site_name" content="ScalaPB" /><meta name="og:url" content="" /><meta name="og:type" content="website" /><meta name="og:description" content="Protocol buffer compiler for Scala" /><link rel="icon" type="image/png" href="/img/favicon.png" /><meta name="twitter:title" content="ScalaPB: FAQ" /><meta name="twitter:image" content="/img/poster.png" /><meta name="twitter:description" content="Protocol buffer compiler for Scala" /><meta name="twitter:card" content="summary_large_image" /><link rel="icon" type="image/png" sizes="16x16" href="/img/favicon16x16.png" /><link rel="icon" type="image/png" sizes="24x24" href="/img/favicon24x24.png" /><link rel="icon" type="image/png" sizes="32x32" href="/img/favicon32x32.png" /><link rel="icon" type="image/png" sizes="48x48" href="/img/favicon48x48.png" /><link rel="icon" type="image/png" sizes="57x57" href="/img/favicon57x57.png" /><link rel="icon" type="image/png" sizes="60x60" href="/img/favicon60x60.png" /><link rel="icon" type="image/png" sizes="64x64" href="/img/favicon64x64.png" /><link rel="icon" type="image/png" sizes="70x70" href="/img/favicon70x70.png" /><link rel="icon" type="image/png" sizes="72x72" href="/img/favicon72x72.png" /><link rel="icon" type="image/png" sizes="76x76" href="/img/favicon76x76.png" /><link rel="icon" type="image/png" sizes="96x96" href="/img/favicon96x96.png" /><link rel="icon" type="image/png" sizes="114x114" href="/img/favicon114x114.png" /><link rel="icon" type="image/png" sizes="120x120" href="/img/favicon120x120.png" /><link rel="icon" type="image/png" sizes="128x128" href="/img/favicon128x128.png" /><link rel="icon" type="image/png" sizes="144x144" href="/img/favicon144x144.png" /><link rel="icon" type="image/png" sizes="150x150" href="/img/favicon150x150.png" /><link rel="icon" type="image/png" sizes="152x152" href="/img/favicon152x152.png" /><link rel="icon" type="image/png" sizes="196x196" href="/img/favicon196x196.png" /><link rel="icon" type="image/png" sizes="310x310" href="/img/favicon310x310.png" /><link rel="icon" type="image/png" sizes="310x150" href="/img/favicon310x150.png" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/highlight/styles/atom-one-light.css" /><link rel="stylesheet" href="/css/pattern-style.css" /><link rel="stylesheet" href="/css/custom.css" /><script async="async">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-346180-20' , 'auto');
ga('send', 'pageview');
      </script></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><ul id="sidebar" class="sidebar-nav"><li class="sidebar-brand"><a href="/" class="brand"><div class="brand-wrapper"><span>ScalaPB</span></div></a></li> <li><a href="/" class="">About</a></li> <li><a href="/sbt-settings.html" class="">SBT Settings</a></li> <li><a href="/generated-code.html" class="">Generated code</a></li> <li><a href="/customizations.html" class="">Customizations</a></li> <li><a href="/sealed-oneofs.html" class="">Sealed oneofs</a></li> <li><a href="/user_defined_options.html" class="">User-defined options</a></li> <li><a href="/grpc.html" class="">gRPC</a></li> <li><a href="/scala.js.html" class="">Scala.js</a></li> <li><a href="/sparksql.html" class="">SparkSQL</a></li> <li><a href="/json.html" class="">JSON</a></li> <li><a href="/scalapbc.html" class="">ScalaPBC</a></li> <li><a href="/third-party-protos.html" class="">Using third-party protos</a></li> <li><a href="/common-protos.html" class="">Common protos</a></li> <li><a href="/api/scalapb/latest/" class="">API Docs</a></li> <li><a href="/faq.html" class=" active ">FAQ</a></li> <li><a href="/migrating.html" class="">Migrating</a></li> <li><a href="/contact.html" class="">Contact us</a></li></ul></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li id="gh-eyes-item" class="hidden-xs"><a href="https://github.com/scalapb/ScalaPB" target="_blank" rel="noopener noreferrer"><i class="fa fa-eye"></i><span>Watchers<span id="eyes" class="label label-default">--</span></span></a></li><li id="gh-stars-item" class="hidden-xs"><a href="https://github.com/scalapb/ScalaPB" target="_blank" rel="noopener noreferrer"><i class="fa fa-star-o"></i><span>Stars<span id="stars" class="label label-default">--</span></span></a></li><li><a href="#" onclick="shareSiteTwitter('ScalaPB Protocol buffer compiler for Scala');"><i class="fa fa-twitter"></i></a></li><li><a href="#" onclick="shareSiteFacebook('ScalaPB Protocol buffer compiler for Scala');"><i class="fa fa-facebook"></i></a></li><li><a href="#" onclick="shareSiteGoogle();"><i class="fa fa-google-plus"></i></a></li></ul></div></div></div></div><div id="content" data-github-owner="scalapb" data-github-repo="ScalaPB"><div class="content-wrapper"><section><h1 id="frequently-asked-questions">Frequently Asked Questions</h1>

<h2 id="intellij-complains-on-duplicate-files-class-is-already-defined">IntelliJ complains on duplicate files (“class is already defined”)</h2>

<p>If you are using sbt-protoc this should not happen. Please file a bug.</p>

<p>If you are still using sbt-scalapb, please switch to sbt-protoc as described
in the installation instruction.</p>

<p>sbt-protobuf which sbt-scalapb relies on defaults to generating the case
classes in <code class="highlighter-rouge">target/src_managed/compiled_protobuf/</code>.  This leads to a situation
where both <code class="highlighter-rouge">target/src_managed/compiled_protobuf/</code> and its parent, <code class="highlighter-rouge">target/src_managed/</code>,
are considered source directories and the source files are seen twice. To
eliminate this problem, let’s tell sbt-protobuf to generate the sources into
the parent directory. Add this to your <code class="highlighter-rouge">build.sbt</code>:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">scalaSource</span> <span class="n">in</span> <span class="nv">PB</span><span class="o">.</span><span class="py">protobufConfig</span> <span class="o">:=</span> <span class="nv">sourceManaged</span><span class="o">.</span><span class="py">value</span>
</code></pre></div></div>

<p>If you generate Java sources, add,</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">javaSource</span> <span class="n">in</span> <span class="nv">PB</span><span class="o">.</span><span class="py">protobufConfig</span> <span class="o">:=</span> <span class="nv">sourceManaged</span><span class="o">.</span><span class="py">value</span>
</code></pre></div></div>

<h2 id="how-do-i-use-scalapb-from-the-command-line">How do I use ScalaPB from the command line?</h2>

<p>Check out <a href="/scalapbc.html">ScalaPBC</a>.</p>

<h2 id="how-do-i-use-scalapb-with-maven">How do I use ScalaPB with Maven?</h2>

<p>ScalaPB code generator can be invoked in your Maven build through the protobuf-maven-plugin. See <a href="https://github.com/thesamet/scalapb-maven-example">example project</a>.</p>

<p>The relevant parts are marked with “Add protobuf-maven-plugin…”</p>

<h2 id="how-do-i-get-grpc-java-conversions-flat-packages-etc-with-maven">How do I get grpc, java conversions, flat packages, etc with Maven?</h2>

<p>The example maven project invokes ScalaPBC. To get these ScalaPB features, you need to pass a
generator parameter to ScalaPBC. See the supported generator parameters and how to use them in
<a href="/scalapbc.html">ScalaPBC</a> documentation.</p>

<h2 id="i-am-getting-import-was-not-found-or-had-errors">I am getting “Import was not found or had errors”</h2>

<p>If you are using sbt-protoc and importing protos like <code class="highlighter-rouge">scalapb/scalapb.proto</code>,
or common protocol buffers like <code class="highlighter-rouge">google/protobuf/wrappers.proto</code>:</p>

<p>Add the following to your <code class="highlighter-rouge">build.sbt</code>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>libraryDependencies += "com.thesamet.scalapb" %% "scalapb-runtime" % scalapb.compiler.Version.scalapbVersion % "protobuf"
</code></pre></div></div>

<p>This tells <code class="highlighter-rouge">sbt-protoc</code> to extract protos from this jar (and all its
dependencies, which includes Google’s common protos), and make them available
in the include path that is passed to protoc.</p>

<p>If you are not using sbt (for example, spbc), then you need to make those
files available on the file system.</p>

<h2 id="how-do-i-generate-scala-code-for-protos-from-another-jar">How do I generate Scala code for protos from another jar?</h2>

<p>For some proto packages, we may already provide pre-compiled generated code in
 <a href="https://github.com/scalapb/common-protos">ScalaPB’s Common Protos project</a>.
 If what you are looking for is not there, consider adding it by following the
 instructions on the project’s page.</p>

<p>To build it yourself using SBT: include the jar as a <code class="highlighter-rouge">protobuf</code> dependency in your libraryDependencies:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">libraryDependencies</span> <span class="o">+=</span> <span class="s">"com.somepackage"</span> <span class="o">%%</span> <span class="s">"that-has-jar"</span> <span class="o">%</span> <span class="s">"1.0"</span> <span class="o">%</span> <span class="s">"protobuf-src"</span> <span class="nf">transitive</span><span class="o">()</span>
</code></pre></div></div>

<p>This will tell sbt-protoc to extract the protos from that jar into
<code class="highlighter-rouge">target/scala-2.vv/protobuf_external_src</code> and add them both to the import
search path and the set of sources to generate code for (<code class="highlighter-rouge">PB.protoSources</code>).</p>

<p>The <code class="highlighter-rouge">intransitive</code> modifier makes it not unpack the dependencies of this
library to the same directory since you may not want to generate classes for them
as well. Many common libraries depend on <code class="highlighter-rouge">protobuf-java</code>, and generated
classes for them are already shipped with ScalaPB’s <code class="highlighter-rouge">scalapb-runtime</code>. When
using <code class="highlighter-rouge">intransitive()</code>, you should ensure all the dependencies are provided,
either as <code class="highlighter-rouge">protobuf-src</code> or <code class="highlighter-rouge">protobuf</code> (depending if you want to compile them
or just import them).</p>

<p>You may find other protos under <code class="highlighter-rouge">protobuf_external_src</code> that you do not wish to
compile. You can exclude them by adding an <code class="highlighter-rouge">includeFilter</code>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>includeFilter in PB.generate := new SimpleFileFilter(
  (f: File) =&gt;  f.getParent.endsWith("com/thesamet/protos"))
</code></pre></div></div>

<p>See <a href="https://github.com/thesamet/sbt-protoc/tree/master/examples/multi-with-external-jar">full example here</a>.</p>

<h2 id="how-do-i-represent-optiont-in-proto3-for-scalar-fields">How do I represent <code class="highlighter-rouge">Option[T]</code> in proto3 for scalar fields?</h2>

<p>Scalar fields are the various numeric types, <code class="highlighter-rouge">bool</code>, <code class="highlighter-rouge">string</code>, <code class="highlighter-rouge">byte</code> and <code class="highlighter-rouge">enum</code> -
everything except of messages. In the proto2 wire format, there is a distinction between
not setting a value (<code class="highlighter-rouge">None</code>), or setting it to its default value (<code class="highlighter-rouge">Some(0)</code> or
<code class="highlighter-rouge">Some("")</code>).</p>

<p>In proto3, this distinction has been removed in the wire format. Whenever the value
of a scalar type is zero, it does not get serialized. Therefore, the parser is not
able to distinguish between <code class="highlighter-rouge">Some(0)</code> or <code class="highlighter-rouge">None</code>. The semantics is that a <a href="https://developers.google.com/protocol-buffers/docs/proto3#default">zero
has been received</a>.</p>

<p>Optional message types are still wrapped in <code class="highlighter-rouge">Option[]</code> since there is a
distinction in the wire format between leaving out a message (which is
represent by <code class="highlighter-rouge">None</code> or sending one, even if all its fields are unset (or
assigned default values). If you wish to have <code class="highlighter-rouge">Option[]</code> around scalar
types in proto3, you can use this fact to your advantage by using <a href="/customizations.html#primitive-wrappers">primitive wrappers</a></p>

<h2 id="why-a-certain-customization-is-not-available-as-a-global-generator-parameter">Why a certain customization is not available as a global generator parameter?</h2>

<p>It turns out that global generator parameters that affect source code compatibility are something that we would like to avoid, as it is creating issues that are tricky to resolve. For example, if:</p>

<ul>
  <li>package A provides proto files and generate source code with one value of a generator parameter,</li>
  <li>package B is compiled separately with a different value of this generator parameter, and imports protos from package A, as well as its generated classes.</li>
</ul>

<p>then the code generator for B has no way of knowing that package A has code generated with a different parameter, and that it needs to account for that in the way it references it. This leads to compilation errors in ScalaPB or in user-provided code generators.</p>

<p>In version 0.8.2, we introduced <a href="/customizations.html#package-scoped-options">package-scoped options</a> which let you set file-level options for an entire package at once.</p>

<h2 id="how-do-i-write-my-own-scala-code-generator-for-protocol-buffers">How do I write my own Scala code generator for protocol buffers?</h2>

<p>Easy! Check out <a href="https://github.com/scalapb/scalapb-plugin-template.g8">giter8 template for writing new code generators</a>.</p>

<h2 id="how-do-i-use-scalapb-with-gradle">How do I use ScalaPB with Gradle?</h2>

<p>You can use ScalaPB with the official <a href="https://github.com/google/protobuf-gradle-plugin">Protobuf Plugin for Gradle</a>.</p>

<p>In your <code class="highlighter-rouge">build.gradle</code> the <code class="highlighter-rouge">protobuf</code> section should look like this:</p>

<div class="language-gradle highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ext</span> <span class="o">{</span>
  <span class="n">scalapbVersion</span> <span class="o">=</span> <span class="s1">'0.10.1'</span>
<span class="o">}</span>

<span class="k">dependencies</span> <span class="o">{</span>
  <span class="n">compile</span> <span class="s2">"com.thesamet.scalapb:scalapb-runtime_2.12:${scalapbVersion}"</span>
<span class="o">}</span>

<span class="n">protobuf</span> <span class="o">{</span>
  <span class="n">protoc</span> <span class="o">{</span>
    <span class="n">artifact</span> <span class="o">=</span> <span class="s1">'com.google.protobuf:protoc:3.11.4'</span>
  <span class="o">}</span>
  <span class="n">plugins</span> <span class="o">{</span>
    <span class="n">scalapb</span> <span class="o">{</span>
      <span class="n">artifact</span> <span class="o">=</span> <span class="o">(</span><span class="n">org</span><span class="o">.</span><span class="na">gradle</span><span class="o">.</span><span class="na">nativeplatform</span><span class="o">.</span><span class="na">platform</span><span class="o">.</span><span class="na">internal</span><span class="o">.</span><span class="na">DefaultNativePlatform</span><span class="o">.</span><span class="na">getCurrentOperatingSystem</span><span class="o">().</span><span class="na">isWindows</span><span class="o">())</span> <span class="o">?</span>
          <span class="s2">"com.thesamet.scalapb:protoc-gen-scala:${scalapbVersion}:windows@bat"</span> <span class="o">:</span>
          <span class="s2">"com.thesamet.scalapb:protoc-gen-scala:${scalapbVersion}:unix@sh"</span>
    <span class="o">}</span>
  <span class="o">}</span>

  <span class="n">generateProtoTasks</span> <span class="o">{</span>
    <span class="n">all</span><span class="o">().</span><span class="na">each</span> <span class="o">{</span> <span class="n">task</span> <span class="o">-&gt;</span>
      <span class="n">task</span><span class="o">.</span><span class="na">builtins</span> <span class="o">{</span>
          <span class="c1">// if you don't want java code to be generated.</span>
          <span class="n">remove</span> <span class="n">java</span>
      <span class="o">}</span>
      <span class="n">task</span><span class="o">.</span><span class="na">plugins</span> <span class="o">{</span>
          <span class="n">scalapb</span> <span class="o">{</span>
            <span class="c1">// add any ScalaPB generator options here. See: https://scalapb.github.io/scalapbc.html#passing-generator-parameters</span>
            <span class="c1">// option 'flat_package'</span>
          <span class="o">}</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// Add geneated Scala code as a source directory</span>
<span class="k">sourceSets</span> <span class="o">{</span>
  <span class="n">main</span> <span class="o">{</span>
    <span class="n">scala</span> <span class="o">{</span>
        <span class="n">srcDirs</span> <span class="s2">"${protobuf.generatedFilesBaseDir}/main/scalapb"</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>See <a href="https://github.com/scalapb/gradle-demo">full example here</a>.</p>
</section></div></div></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script><script src="/highlight/highlight.pack.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/protobuf.min.js"></script><script>
// For all code blocks, copy the language from the containing div
// to the inner code tag (where hljs expects it to be)
const langPrefix = 'language-';
document.querySelectorAll(`div[class^='${langPrefix}']`).forEach(function(div) {
  div.classList.forEach(function(cssClass) {
    if (cssClass.startsWith(langPrefix)) {
      const lang = cssClass.substring(langPrefix.length);
      div.querySelectorAll('pre code').forEach(function(code) {
        code.classList.add(lang);
      });
    }
  });
});

hljs.configure({languages:['scala','java','bash','protobuf']});
hljs.initHighlightingOnLoad();
      </script><script>console.info('\x57\x65\x62\x73\x69\x74\x65\x20\x62\x75\x69\x6c\x74\x20\x77\x69\x74\x68\x3a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x5f\x20\x20\x20\x20\x5f\x5f\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x20\x5f\x5f\x0a\x20\x20\x20\x5f\x5f\x5f\x5f\x5f\x2f\x20\x2f\x5f\x20\x20\x2f\x20\x2f\x5f\x20\x20\x20\x20\x20\x20\x5f\x5f\x5f\x5f\x20\x5f\x5f\x5f\x20\x20\x28\x5f\x29\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x20\x20\x5f\x5f\x5f\x5f\x5f\x28\x5f\x29\x20\x2f\x5f\x5f\x5f\x5f\x20\x20\x5f\x5f\x5f\x5f\x5f\x0a\x20\x20\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x5c\x2f\x20\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x60\x5f\x5f\x20\x5c\x2f\x20\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x5c\x2f\x20\x5f\x5f\x5f\x2f\x20\x2f\x20\x5f\x5f\x2f\x20\x5f\x20\x5c\x2f\x20\x5f\x5f\x5f\x2f\x0a\x20\x28\x5f\x5f\x20\x20\x29\x20\x2f\x5f\x2f\x20\x2f\x20\x2f\x5f\x2f\x5f\x5f\x5f\x5f\x5f\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x5f\x5f\x2f\x20\x2f\x20\x20\x2f\x20\x2f\x5f\x2f\x20\x28\x5f\x5f\x20\x20\x29\x20\x2f\x20\x2f\x5f\x2f\x20\x20\x5f\x5f\x28\x5f\x5f\x20\x20\x29\x0a\x2f\x5f\x5f\x5f\x5f\x2f\x5f\x2e\x5f\x5f\x5f\x2f\x5c\x5f\x5f\x2f\x20\x20\x20\x20\x20\x2f\x5f\x2f\x20\x2f\x5f\x2f\x20\x2f\x5f\x2f\x5f\x2f\x5c\x5f\x5f\x5f\x2f\x5f\x2f\x20\x20\x20\x5c\x5f\x5f\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x2f\x5f\x2f\x5c\x5f\x5f\x2f\x5c\x5f\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x2f\x0a\x0a\x68\x74\x74\x70\x73\x3a\x2f\x2f\x34\x37\x64\x65\x67\x2e\x67\x69\x74\x68\x75\x62\x2e\x69\x6f\x2f\x73\x62\x74\x2d\x6d\x69\x63\x72\x6f\x73\x69\x74\x65\x73')</script><script>((window.gitter = {}).chat = {}).options = {
room: 'ScalaPB/community'};</script><script src="https://sidecar.gitter.im/dist/sidecar.v1.js"></script><script src="/js/main.js"></script></body></html>